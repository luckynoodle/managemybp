<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="description" content="Track and manage your blood pressure readings">
    <meta name="theme-color" content="#2563eb">
    <title>Blood Pressure Tracker</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>ðŸ’™ Blood Pressure Tracker</h1>
            <p class="subtitle">Track your readings with ease</p>
            <button class="help-btn" id="help-btn" aria-label="User guide">?</button>
        </header>

        <nav class="nav-bar">
            <a href="index.html" class="nav-link active">New Reading</a>
            <a href="history.html" class="nav-link">History</a>
        </nav>

        <main>
            <!-- New Reading Session Section -->
            <section class="card" id="new-session-section">
                <h2>New Reading Session</h2>

                <form id="reading-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="systolic">Systolic (mmHg)</label>
                            <input
                                type="number"
                                inputmode="numeric"
                                id="systolic"
                                name="systolic"
                                min="70"
                                max="200"
                                required
                                placeholder="120"
                            >
                        </div>

                        <div class="form-group">
                            <label for="diastolic">Diastolic (mmHg)</label>
                            <input
                                type="number"
                                inputmode="numeric"
                                id="diastolic"
                                name="diastolic"
                                min="40"
                                max="130"
                                required
                                placeholder="80"
                            >
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="pulse">Pulse (bpm) <span class="optional">Optional</span></label>
                        <input
                            type="number"
                            inputmode="numeric"
                            id="pulse"
                            name="pulse"
                            min="40"
                            max="200"
                            placeholder="70"
                        >
                    </div>

                    <button type="submit" class="btn btn-primary" id="add-reading-btn">
                        Add Reading
                    </button>
                </form>

                <!-- Current Session Readings -->
                <div id="current-readings-section" class="hidden">
                    <h3>Current Session (<span id="reading-count">0</span>/10)</h3>
                    <div id="current-readings-list"></div>

                    <div class="form-group">
                        <label for="session-notes">Notes <span class="optional">Optional</span></label>
                        <textarea
                            id="session-notes"
                            name="session-notes"
                            rows="2"
                            placeholder="Add any notes about this session (e.g., time of day, before/after medication, symptoms, etc.)"
                            maxlength="500"
                        ></textarea>
                        <span class="char-count"><span id="notes-char-count">0</span>/500</span>
                    </div>

                    <div class="button-group">
                        <button class="btn btn-success" id="save-session-btn">
                            Save Session
                        </button>
                        <button class="btn btn-secondary" id="clear-session-btn">
                            Clear
                        </button>
                    </div>
                </div>
            </section>
        </main>

        <footer>
            <p>Data is stored locally on your device and automatically deleted after 30 days.</p>
        </footer>
    </div>

    <!-- User Guide Modal -->
    <div class="modal-overlay" id="guide-modal">
        <div class="modal">
            <div class="modal-header">
                <h2>User Guide</h2>
                <button class="modal-close" id="guide-close" aria-label="Close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="guide-section">
                    <h3>Adding a Reading</h3>
                    <ul>
                        <li>Enter your systolic pressure (70-200 mmHg)</li>
                        <li>Enter your diastolic pressure (40-130 mmHg)</li>
                        <li>Optionally enter your pulse rate (40-200 bpm)</li>
                        <li>Tap "Add Reading" to add it to the session</li>
                    </ul>
                </div>
                <div class="guide-section">
                    <h3>Saving a Session</h3>
                    <ul>
                        <li>Add up to 10 readings per session for accurate averages</li>
                        <li>Optionally add notes (time of day, medication, symptoms)</li>
                        <li>Tap "Save Session" to store with calculated averages</li>
                        <li>Use "Clear" to discard and start over</li>
                    </ul>
                </div>
                <div class="guide-section">
                    <h3>Viewing History</h3>
                    <ul>
                        <li>Navigate to the "History" tab to view saved sessions</li>
                        <li>Filter by date range: 7 days, 14 days, 30 days, or custom</li>
                        <li>View the trend graph showing systolic, diastolic, and pulse</li>
                        <li>Tap a session to expand details and view individual readings</li>
                    </ul>
                </div>
                <div class="guide-section">
                    <h3>BP Classification Zones</h3>
                    <p>The trend graph displays colour-coded background zones:</p>
                    <ul>
                        <li><strong>Low</strong> (blue) - Below 90 mmHg systolic</li>
                        <li><strong>Normal</strong> (green) - 90-120 mmHg systolic</li>
                        <li><strong>Elevated</strong> (amber) - 120-140 mmHg systolic</li>
                        <li><strong>High</strong> (red) - Above 140 mmHg systolic</li>
                    </ul>
                </div>
                <div class="guide-section">
                    <h3>Colour Vision Difference Mode</h3>
                    <p>Tap the "CVD" button on the trend graph to switch to an accessible colour palette. Lines will use different dash patterns and dot shapes for easier identification. Your preference is saved automatically.</p>
                </div>
                <div class="guide-section">
                    <h3>Managing Data</h3>
                    <ul>
                        <li><strong>Export</strong> - Download all sessions as a text file</li>
                        <li><strong>Delete</strong> - Expand a session and tap "Delete Session"</li>
                        <li><strong>Clear All</strong> - Remove all sessions at once</li>
                    </ul>
                </div>
                <div class="guide-section">
                    <h3>About</h3>
                    <p>All data is stored locally on your device. No data is sent to any server. Readings older than 30 days are automatically removed.</p>
                </div>
            </div>
        </div>
    </div>

    <script src="storage.js"></script>
    <script src="app.js"></script>
</body>
</html>
