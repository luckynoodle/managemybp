<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="description" content="View your blood pressure history and trends">
    <meta name="theme-color" content="#2563eb">
    <title>History - Blood Pressure Tracker</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>ðŸ’™ Blood Pressure Tracker</h1>
            <p class="subtitle">History &amp; Trends</p>
            <button class="help-btn" id="help-btn" aria-label="User guide">?</button>
        </header>

        <nav class="nav-bar">
            <a href="index.html" class="nav-link">New Reading</a>
            <a href="history.html" class="nav-link active">History</a>
        </nav>

        <main>
            <!-- Filter Section -->
            <section class="card">
                <h2>Date Range</h2>
                <div class="filter-buttons">
                    <button class="filter-btn active" data-filter="7">Last 7 days</button>
                    <button class="filter-btn" data-filter="14">Last 14 days</button>
                    <button class="filter-btn" data-filter="30">Last 30 days</button>
                    <button class="filter-btn" data-filter="custom">Custom</button>
                </div>
                <div class="custom-date-range hidden" id="custom-date-range">
                    <div>
                        <label for="start-date">From</label>
                        <input type="date" id="start-date" name="start-date">
                    </div>
                    <div>
                        <label for="end-date">To</label>
                        <input type="date" id="end-date" name="end-date">
                    </div>
                </div>
            </section>

            <!-- Trend Graph -->
            <section class="graph-container" id="graph-section">
                <div class="graph-header">
                    <h2>Trend</h2>
                    <button class="cb-toggle" id="cb-toggle" aria-label="Toggle colour vision difference mode">CVD</button>
                </div>
                <div class="graph-canvas-wrap">
                    <canvas id="trend-canvas"></canvas>
                </div>
                <div class="graph-legend">
                    <div class="legend-item">
                        <div class="legend-color" id="legend-sys" style="background: #ef4444;"></div>
                        <span>Systolic</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" id="legend-dia" style="background: #3b82f6;"></div>
                        <span>Diastolic</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" id="legend-pulse" style="background: #10b981;"></div>
                        <span>Pulse</span>
                    </div>
                </div>
                <div class="graph-legend graph-legend-zones">
                    <div class="legend-item">
                        <div class="legend-color" id="legend-low" style="background: rgba(59, 130, 246, 0.25);"></div>
                        <span>Low</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" id="legend-normal" style="background: rgba(16, 185, 129, 0.25);"></div>
                        <span>Normal</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" id="legend-elevated" style="background: rgba(245, 158, 11, 0.25);"></div>
                        <span>Elevated</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" id="legend-high" style="background: rgba(239, 68, 68, 0.25);"></div>
                        <span>High</span>
                    </div>
                </div>
            </section>

            <!-- History List -->
            <section class="card" id="history-section">
                <div class="history-header-section">
                    <h2>Sessions (<span id="session-count">0</span>)</h2>
                    <div class="history-actions">
                        <button class="btn btn-secondary btn-sm" id="export-data-btn">
                            Export
                        </button>
                        <button class="btn btn-danger btn-sm" id="clear-all-btn">
                            Clear All
                        </button>
                    </div>
                </div>
                <div id="history-list" class="history-list">
                    <p class="empty-state">No readings in selected date range.</p>
                </div>
            </section>
        </main>

        <footer>
            <p>Data is stored locally on your device and automatically deleted after 30 days.</p>
        </footer>
    </div>

    <!-- User Guide Modal -->
    <div class="modal-overlay" id="guide-modal">
        <div class="modal">
            <div class="modal-header">
                <h2>User Guide</h2>
                <button class="modal-close" id="guide-close" aria-label="Close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="guide-section">
                    <h3>Adding a Reading</h3>
                    <ul>
                        <li>Enter your systolic pressure (70-200 mmHg)</li>
                        <li>Enter your diastolic pressure (40-130 mmHg)</li>
                        <li>Optionally enter your pulse rate (40-200 bpm)</li>
                        <li>Tap "Add Reading" to add it to the session</li>
                    </ul>
                </div>
                <div class="guide-section">
                    <h3>Saving a Session</h3>
                    <ul>
                        <li>Add up to 10 readings per session for accurate averages</li>
                        <li>Optionally add notes (time of day, medication, symptoms)</li>
                        <li>Tap "Save Session" to store with calculated averages</li>
                        <li>Use "Clear" to discard and start over</li>
                    </ul>
                </div>
                <div class="guide-section">
                    <h3>Viewing History</h3>
                    <ul>
                        <li>Navigate to the "History" tab to view saved sessions</li>
                        <li>Filter by date range: 7 days, 14 days, 30 days, or custom</li>
                        <li>View the trend graph showing systolic, diastolic, and pulse</li>
                        <li>Tap a session to expand details and view individual readings</li>
                    </ul>
                </div>
                <div class="guide-section">
                    <h3>BP Classification Zones</h3>
                    <p>The trend graph displays colour-coded background zones:</p>
                    <ul>
                        <li><strong>Low</strong> (blue) - Below 90 mmHg systolic</li>
                        <li><strong>Normal</strong> (green) - 90-120 mmHg systolic</li>
                        <li><strong>Elevated</strong> (amber) - 120-140 mmHg systolic</li>
                        <li><strong>High</strong> (red) - Above 140 mmHg systolic</li>
                    </ul>
                </div>
                <div class="guide-section">
                    <h3>Colour Vision Difference Mode</h3>
                    <p>Tap the "CVD" button on the trend graph to switch to an accessible colour palette. Lines will use different dash patterns and dot shapes for easier identification. Your preference is saved automatically.</p>
                </div>
                <div class="guide-section">
                    <h3>Managing Data</h3>
                    <ul>
                        <li><strong>Export</strong> - Download all sessions as a text file</li>
                        <li><strong>Delete</strong> - Expand a session and tap "Delete Session"</li>
                        <li><strong>Clear All</strong> - Remove all sessions at once</li>
                    </ul>
                </div>
                <div class="guide-section">
                    <h3>About</h3>
                    <p>All data is stored locally on your device. No data is sent to any server. Readings older than 30 days are automatically removed.</p>
                </div>
            </div>
        </div>
    </div>

    <script src="storage.js"></script>
    <script src="history.js"></script>
</body>
</html>
